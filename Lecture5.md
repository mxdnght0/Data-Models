# Конспект лекции по базам данных: Нормализация и транзакции

## Введение в нормализацию

Нормализация — это процесс преобразования таблиц базы данных для устранения избыточности данных и аномалий операций. Основная цель — привести структуру базы к определённым нормальным формам, что повышает целостность и эффективность работы с данными.

## Проблемы, решаемые нормализацией

**Аномалии данных:**

- **Аномалия добавления**  
  Невозможность добавить данные о одной сущности без наличия данных о связанной сущности.  
  *Пример: нельзя добавить предмет без студента, которому он принадлежит.*

- **Аномалия удаления**  
  Потеря информации о одной сущности при удалении другой.  
  *Пример: удаление студента может привести к потере информации о предмете, если он был привязан только к этому студенту.*

- **Аномалия обновления**  
  Необходимость вносить изменения в несколько мест для сохранения целостности данных.  
  *Пример: изменение имени студента требует обновления всех записей, где оно встречается.*

## Функциональные зависимости

Функциональная зависимость — связь между атрибутами, где значение одного атрибута однозначно определяет значение другого.

**Обозначение:** A → B, где:
- A — детерминант,
- B — зависимый атрибут.

**Примеры:**
- Номер паспорта → ФИО, СНИЛС
- Номер заказа → Дата заказа, сумма

## Нормальные формы

### 1. Первая нормальная форма (1НФ)

**Условия:**
- Все значения атрибутов атомарны (не составные)
- Отсутствуют повторяющиеся группы

**Пример нарушения:**  
Хранение нескольких номеров телефонов в одном поле или в нескольких столбцах (телефон1, телефон2...).  
**Решение:** вынести телефоны в отдельную таблицу.

### 2. Вторая нормальная форма (2НФ)

**Условия:**
- Отношение находится в 1НФ
- Все неключевые атрибуты полностью зависят от всего потенциального ключа

**Пример:**  
В таблице "Студент-Предмет-Оценка" атрибуты имени и фамилии зависят только от студента, а не от пары (студент, предмет).  
**Решение:** разделить на таблицы "Студенты" и "Оценки".

### 3. Третья нормальная форма (3НФ)

**Условия:**
- Отношение находится в 2НФ
- Отсутствуют транзитивные зависимости (когда неключевой атрибут зависит от другого неключевого атрибута)

**Пример:**  
В таблице "Преподаватель-Кафедра-Телефон" телефон зависит от кафедры, а кафедра — от преподавателя.  
**Решение:** выделить кафедру в отдельную таблицу.

### 4. Нормальная форма Бойса-Кодда (НФБК)

**Условия:**
- Более строгая версия 3НФ
- Все детерминанты являются потенциальными ключами

**Особенность:** если ключ состоит из одного атрибута, то 3НФ автоматически соответствует НФБК.

### 5. Четвёртая нормальная форма (4НФ)

**Условия:**
- Отношение находится в НФБК
- Отсутствуют нетривиальные многозначные зависимости

**Пример:**  
Таблица "Преподаватель-Студент-Предмет", где один преподаватель ведёт несколько предметов и имеет несколько студентов.  
**Решение:** разделить на две таблицы: "Преподаватель-Предмет" и "Преподаватель-Студент".

### 6. Пятая нормальная форма (5НФ)

**Условия:**
- Отношение находится в 4НФ
- Отсутствуют зависимости соединения без потерь

**Пример:**  
Циклические бизнес-правила, например, связь "Поставщик-Деталь-Проект".  
**Решение:** добавить недостающую сущность или пересмотреть логику проектирования.

## Практические рекомендации

- Чаще всего на практике используются 1НФ, 2НФ и 3НФ
- НФБК, 4НФ и 5НФ применяются реже, обычно в сложных системах с высокими требованиями к целостности
- Если при проектировании возникают проблемы с нормализацией, возможно, не хватает сущностей в логической модели

## Транзакции и операции с данными

### Оператор DELETE

- `DELETE FROM table` — удаляет все записи
- **ON DELETE** — правила при удалении записей, на которые есть ссылки:
  - `SET NULL` — устанавливает NULL в ссылающихся записях
  - `SET DEFAULT` — устанавливает значение по умолчанию
  - `RESTRICT / NO ACTION` — запрещают удаление, если есть ссылки
  - `CASCADE` — каскадное удаление связанных записей

**Рекомендация:** избегать CASCADE, вместо этого использовать мягкое удаление (поле `is_deleted`).

### Партиционирование таблиц

Партиционирование — горизонтальное разделение таблицы на части для ускорения работы с большими данными.

**Пример:**  
Разделение таблицы транзакций по годам. Каждый год — отдельная дочерняя таблица.

**Преимущества:**
- Ускорение запросов
- Упрощение управления данными

## Заключение

Нормализация — ключевой этап проектирования реляционных баз данных, который позволяет избежать аномалий и избыточности. На практике чаще всего достаточно 3НФ, но важно понимать все формы для проектирования сложных систем. Дополнительные техники, такие как партиционирование и правильная настройка операций удаления, помогают оптимизировать работу с данными.
